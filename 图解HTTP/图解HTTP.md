# 图解HTTP

## 第一章 了解Web及网络基础
### 1.1 使用HTTP协议访问web

- 通过发送请求获取服务器资源的Web浏览器等，都可以称为**客户端(client)**
![][image-1]

### 1.3 网络基础TCP/IP
通常使用的网络（包括互联网）是在TCP/IP协议族的基础运作的。而HTTP属于它内部的一个子集。

#### 1.3.2 TCP/IP的分层管理
TCP/IP协议族按层次分为

- 应用层
	-  决定了向用户提供应用服务时通信的活动（例如FTP(File Transfer Protocol)/DNS(Domain Name System)等）
	- HTTP协议处于该层
- 传输层
	- 对上层应用层，提供了网络连接中的两台计算机之间的数据传输
	- 传输层有两个性质不同的协议：TCP(Transmission Control Protocol)和UDP(User Data Protocol)
- 网络层
	- 用来处理在网络上流动的数据包（是网络传输的最小数据）。
	- 规定了通过怎样的路径（就是传输路线）到达对方计算机，并把数据包传送给对方
- 数据链路层
	- 用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（网卡），及光纤等物理课件部分。硬件范畴均在链路层。

#### 1.3.3 TCP/IP 通信传输流
![][image-2]

利用TCP/IP协议族进行网络通信时，会通过分成顺序与对方进行通信。  
发送端从应用层往下走，接收端则往上走。  

**封装**：发送端在层与层之间的传输数据时，每经过一层时必定会被打上一个改层所属的首部信息。反之，接收端在层与层传输数据时，每经过一一层时，会把对应的首部消去。

### 1.4 与HTTP关系密切的协议:IP、TCP和DNS
#### 1.4.1 负责传输的IP协议
IP（Internet Protocol）网际协议位于网络层 ，是协议名称，有别于IP地址 
作用就是把各种数据包传送给对方，为确保传送到对方那里，需要满足条件，其中两个重要的条件是IP地址和MAC地址

- IP地址指明了节点分配的地址（可变换）
- MAC地址指的是网卡所属的固定地址（基本不会改）
- 使用ARP协议凭借MAC地址进行通信
- IP间的通信以来MAC地址，因为通信双方在同一个局域网内的情况很少，在进行中转时，会利用下一站中转设备的MAC地址来搜索下一个中转目标。
	- 这时采用ARP协议（Address Resolution Protocol），是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。

![][image-3]

#### 1.4.2 确保可靠性的TCP协议
桉层次分，TCP位于传输层，提供可靠的字节流服务。
也就是，TCP协议为了更容易传送大数据才把数据分割，而且TCP协议能够确认数据最终是否送达到对方。

为了准确无误地将数据送达目标处，TCP协议采用了**三次握手**策略。（使用了TCP的标准——SYN（synchronize）和ACK（acknowledge））

- 发送端首先发送一个带SYN标志的数据包给对方
- 接收端收到后回传一个带有SYN/ACK标志的数据包以示传达确认信息
- 发送端再回传一个带ACK标准的数据包，代表握手结束

### 1.5 负责域名解析的DNS服务
DNS（Domain Name System）服务是和HTTP协议一样位于应用层的协议。提供域名和IP地址之间的解析服务。  
用户通常通过主机名或域名来访问对方的计算机，而不是直接通过IP地址。  
计算机不理解名称，更擅长处理一长串数字。  
DNS协议提供通过域名查找IP地址，或逆向从IP地址反查域名的服务

### 1.6 各种协议与HTTP协议的关系
![][image-4]

### 1.7 URI 和URL
与URI（统一资源标识符）相比，我们更熟悉URL（Uniform Resource Locator，统一资源定位符）。
#### 1.7.1 URI 统一资源标识符
URI = Uniform Resource Identifier  
URI用字符串标识某一互联网资源，而URL表示资源的地点（互联网上所处的位置）。URL是URI的子集。


#### 1.7.2 URI格式

- 绝对URI
	- 使用http或者https等协议方案名获取访问资源时要指定协议类型。最后附一个冒号：
- 绝对URL
- 相对URL：指从浏览器中基本URI处指定的URL，形如/image/logo.gif
- …

## 第二章 简单的HTTP协议
### 2.1 HTTP协议用于客户端和服务器端之间
应用HTTP协议时，必定一端是客户端，一端是服务器端。

### 2.2
HTTP协议规定，请求从客户端发出，最后服务器端响应请求并返回。服务器端在没有接到请求之前是不会发送响应的。
![][image-5]

请求报文：  

- 方法（method）：GET/POST
- 请求URI（request-URI）：e.g /index.htm
- HTTP版本号，用来提示客户端使用的HTTP协议功能。 e.g HTTP/1.1
- (可选)请求首部字段
- (可选)内容实体
![][image-6]
响应报文：

- HTTP版本号
- 状态码
- 状态码的原因短语
- (可选)创建响应的日期时间，是首部字段内的一个属性
- (可选)

### 2.3 HTTP是不保存状态的协议
HTTP是一种不保存状态的协议，即无状态协议。HTTP协议自身不对请求和响应之间的通信状态进行保存。  
为了保存状态功能，引入了Cookie技术。

### 2.4 请求URI定位资源
URI的特定功能，在互联网上任意位置的资源都能访问到。  
HTTP协议使用URI让客户端定位资源  
当客户端请求访问资源而发送请求时，URI需要将作为请求报文中的请求URI包含在内。如果不是访问特定资源，而是对服务器本身发起请求，可以用一个\*来代替URI。`OPTIONS * HTTP/1.1`

### 2.5 告知服务器意图的HTTP方法
HTTP/1.1中可以使用的方法：

- GET：获取资源
- POST： 传输实体主体
- PUT：传输文件 （不带验证机制，存在安全问题。一般不使用）
- HEAD：获得报文首部
	- 和GET方法一样，只是不返回报文主题部分。
	- 用于确认URI的有效性及资源更新的日期时间等

- DELETE：删除文件
	- 与PUT相反，按请求URI删除指定的资源
	- 同样带验证机制，存在安全问题。一般不使用

- OPTIONS：询问支持的方法
	- 查询针对请求URI指定的资源支持的方法
![][image-7]

- TRACE:追踪路径
	- 不常用，容易引发XST攻击（跨站追踪）
- CONNECT：要求用隧道协议链接代理
	- 要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL和TLS协议把通信内容加密后经网络隧道传输

### 2.7 持久连接节省通信量
只要任意一端没有明确提出断开连接，则保持TCP连接状态

#### 2.7.2 管线化：
持久连接使得多数请求以管线化方式发送成为可能。以前发送请求后需要等待并收到响应才能发生下一个请求。管线化技术的出现，不用等待响应亦可直接发送下一个请求。这样可以同时并行发送多个请求。

### 2.8 使用Cookie的状态管理
Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在报文中加入Cookie值发送出去。  
服务器端发现客户端发送过来的Cookie后，检查从哪一个客户端发来的连接请求，然后对比服务器的记录，最后得到之前的状态信息。

[image-1]:	1.png
[image-2]:	2.png
[image-3]:	3.png
[image-4]:	4.png
[image-5]:	5.png
[image-6]:	6.png
[image-7]:	7.png